// FILE: src/pages/ancient-math/index.astro
// ANNOTATION: CORRECTED FILE. The page-specific <style> and <script> tags are now correctly placed inside the BaseLayout component.
---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Card from '@/components/Card.astro';
import ReactGirihDesigner from '@/components/ReactGirihDesigner.astro';
import ReactQuasicrystals from '@/components/ReactQuasicrystals.astro';
import BaseLink from '@/components/BaseLink.astro';
---
<BaseLayout title="Ancient Sophistication" description="The mathematics of Girih tiles and tessellation in Islamic architecture.">

    <style slot="head-styles">
      .nav-link { @apply text-gray-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors py-1 border-b-2 border-transparent; }
      .nav-link.active { @apply text-blue-600 dark:text-blue-400 border-blue-600 dark:border-blue-400 font-semibold; }
    </style>

    <header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg sticky top-[72px] z-40 border-b dark:border-slate-700 -mx-4 px-4 mb-12">
        <div class="container mx-auto flex justify-between items-center py-3">
            <h2 class="text-xl font-bold text-gray-800 dark:text-slate-100">Ancient Sophistication</h2>
            <nav class="hidden md:flex flex-wrap justify-center items-center gap-x-6">
                <a href="#introduction" class="nav-link active">Introduction</a>
                <a href="#the-tiles" class="nav-link">The Tiles</a>
                <a href="#designer" class="nav-link">Designer</a>
                <a href="#deep-dive" class="nav-link">Deep Dive</a>
            </nav>
        </div>
    </header>
    
    <div class="container mx-auto">
        <section id="introduction" class="text-center py-16">
            <h1 class="section-title text-4xl md:text-5xl font-bold mb-4 dark:text-slate-100">An Integration of Knowledge</h1>
            <p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-slate-300">
                The geometric ornamentation in Islamic art reveals a profound mathematical understanding. This exploration focuses on Girih patterns.
            </p>
            <div class="grid md:grid-cols-3 gap-8 my-12 max-w-6xl mx-auto text-left">
                <Card href="#the-tiles" icon="fa-solid fa-infinity" title="Mathematical Wisdom" blurb="Girih patterns create aperiodic arrangements, predating modern quasicrystal discovery." details="The beauty of these patterns stems from aperiodicity, creating complex designs that never repeat. This mathematical concept was mastered by artisans centuries before its formal 'discovery' by modern science."/>
                <Card href="#designer" icon="fa-solid fa-compass-drafting" title="Artisans as Pioneers" blurb="Medieval artisans used simple tools to create these elaborate patterns." details="Without modern computational aids, these artisans relied on a deep, intuitive knowledge of geometry and symmetry, using tools like compasses and straightedges to construct their elaborate designs." />
                <Card href="#deep-dive" icon="fa-solid fa-eye" title="A Different Way of Seeing" blurb="The visual pattern is created by lines drawn on the tiles, not the tiles themselves." details="The true artistry lies in the 'strapwork'—a continuous network of lines drawn over the tiles. This overlay creates the final, intricate pattern that flows across the entire surface." />
            </div>
        </section>

        <section id="the-tiles" class="py-16">
            <div class="text-center">
                 <h1 class="section-title text-4xl md:text-5xl font-bold mb-4 dark:text-slate-100">The Five Fundamental Girih Tiles</h1>
                 <p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-slate-300">All Girih tiles have sides of the same length, and all their angles are multiples of 36°, allowing them to fit together seamlessly.</p>
            </div>
        </section>

        <section id="designer" class="py-16">
            <div class="text-center">
                <h1 class="section-title text-4xl md:text-5xl font-bold mb-4 dark:text-slate-100">Interactive Girih Tile Designer</h1>
                <p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-slate-300">This interactive editor is a React application rendered inside this Astro page. Use the controls to experiment.</p>
            </div>
            <div class="my-12 text-center">
                <ReactGirihDesigner />
            </div>
        </section>
        
        <section id="deep-dive" class="py-16">
            <div class="text-center">
                <h1 class="section-title text-4xl md:text-5xl font-bold mb-4 dark:text-slate-100">Quasicrystals Deep Dive</h1>
                <p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-slate-300">This second React app provides a deeper exploration into the structure and properties of quasicrystalline patterns.</p>
            </div>
            <div class="my-12 text-center">
                <ReactQuasicrystals />
            </div>
        </section>
    </div>

    <div class="text-center mt-16">
        <BaseLink href="/" text="Back to Home" style="secondary" icon="fa-solid fa-arrow-left" />
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('a.nav-link[href^="#"]');
            const sections = document.querySelectorAll('section[id]');
            const header = document.querySelector('header.sticky');
            const headerHeight = header ? header.offsetHeight : 72;
            if (navLinks.length === 0 || sections.length === 0) return;
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href') === `#${id}`);
                        });
                    }
                });
            }, { rootMargin: `-${headerHeight}px 0px -70% 0px` });
            sections.forEach(section => observer.observe(section));
             navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        const elementPosition = targetElement.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.scrollY - headerHeight;
                        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                    }
                });
            });
        });
    </script>
</BaseLayout>
